--
-- V_NARIAD_UNP  (View) 
--
CREATE OR REPLACE FORCE VIEW MASTER.V_NARIAD_UNP
(YY, MM, KOD_PLAT, NAME_PLAT, KOD_PROD, 
 NAME_PROD, NOM_ZD, NARIAD, DOVEREN, DATE_END, 
 VES)
AS 
SELECT V_NARIAD_REESTR.YY,   
	   V_NARIAD_REESTR.MM,   
       V_NARIAD_REESTR.KOD_PLAT,
	   KLS_PREDPR.SHORT_NAME AS NAME_PLAT,   
       KLS_PROD.ID_KIND_NPR AS KOD_PROD,   
       KINDPROD.NAME_NPR AS NAME_PROD,   
	   V_NARIAD_REESTR.NOM_ZD,   
	   V_NARIAD_REESTR.NARIAD,   
	   V_NARIAD_REESTR.DOVEREN,   
	   MAX(V_NARIAD_REESTR.DATE_OTGR) AS DATE_END,  
	   SUM(V_NARIAD_REESTR.VES) AS VES  
FROM V_NARIAD_REESTR, KLS_PROD, KLS_PROD KINDPROD, KLS_PREDPR  
WHERE V_NARIAD_REESTR.PROD_ID_NPR = KLS_PROD.ID_NPR
  AND KINDPROD.ID_NPR = KLS_PROD.ID_KIND_NPR
  AND V_NARIAD_REESTR.KOD_PLAT = KLS_PREDPR.ID
GROUP BY V_NARIAD_REESTR.YY, V_NARIAD_REESTR.MM, KLS_PREDPR.SHORT_NAME, V_NARIAD_REESTR.KOD_PLAT, KINDPROD.NAME_NPR, KLS_PROD.ID_KIND_NPR, V_NARIAD_REESTR.NOM_ZD, V_NARIAD_REESTR.NARIAD, V_NARIAD_REESTR.DOVEREN;


